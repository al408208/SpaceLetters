let playState={preload:preloadPlay,create:createPlay,update:updatePlay};const TIMER=Phaser.Timer.SECOND,CRAFT_VELOCITY=150;let medium_Enemy1=!1,big_Enemy1=!1,medium_Enemy=!1,big_Enemy=!1,endedRound=!1,timer_activated=!1,deadSpacecraft=!1,fixed_Word=!1,bigSpaceShipDead=!1,mediumSpaceshipdead=!1,spaceShip_array=[],words_array=[],uniqueletters=[],CounterMediumSpaceship=0,CounterBigSpaceship=0,level=0,counter=0,score=0,counterSpaceShips=0,counterSpaceShipsWaves=0,rightsLetters=0,rightsLetterswaves=0,writtenLetters=0,time=0,sum=0,objetive="",timeText,scoreText,nave,Spaceships,spaceCraft,background,blasts,Spaceshiplimit,SpaceshipLimit2,SpaceshipsVelocity,fireButton,w,h,SpaceshipWord,musicInGame,musicenabled=!1,DefaultFont={fontSize:"18px",font:"Courier new",fill:"#FFFFFF"},DefaultFontEndRound={fontSize:"50px",font:"Courier new",fill:"#FFFFFF"},DefaultFontEndRound2={fontSize:"30px",font:"Courier new",fill:"#FFFFFF"},CounterSpaceships,eventSpaceships,eventSpaceshipsMediums,eventSpaceshipsBigs;function preloadPlay(){game.load.image("background","assets/imgs/espacio1.jpg"),game.load.image("background2","assets/imgs/espacio2.jpg"),game.load.image("mesh","assets/imgs/malla1.png"),game.load.image("ufo","assets/imgs/ufo.png"),game.load.image("alienNormal","assets/imgs/alien.png"),game.load.image("alienmedium","assets/imgs/alienbig.png"),game.load.image("alienbig","assets/imgs/alienbigbig.png"),game.load.image("alienmini","assets/imgs/alienmini.png"),game.load.image("laser","assets/imgs/laser.png"),game.load.image("black","assets/imgs/negro.jpg"),game.load.spritesheet("blast","assets/imgs/blast2.png",127,127),game.load.spritesheet("selectionated","assets/imgs/laseranimacion.png",189,189),game.load.text("partA","assets/parts/partA.json",!0),game.load.text("partB","assets/parts/partB.json",!0),game.load.text("partC","assets/parts/partC.json",!0),game.load.audio("partAMusic","assets/snds/partamusica.wav"),game.load.audio("partBMusic","assets/snds/partbmusica.wav"),game.load.audio("partCMusic","assets/snds/partcmusica.wav"),game.load.audio("laser","assets/snds/laser.wav"),game.load.audio("sndblast","assets/snds/blast2.wav"),game.load.audio("blip","assets/snds/blip.wav"),game.load.audio("finalround2","assets/snds/finalronda2.wav"),game.load.audio("finalround","assets/snds/finalronda.wav"),game.load.audio("error","assets/snds/error.wav")}function createPlay(){createConfig(),createParallax(),createSpaceCraft(),createSounds(),createSpaceships(),createBlasts(30),createKeyControls(),createHUD()}function createConfig(){w=game.world.width,h=game.world.height,levelConfig=JSON.parse(game.cache.getText("partA")),levelConfigB=JSON.parse(game.cache.getText("partB")),levelConfigC=JSON.parse(game.cache.getText("partC")),1==partA?(background=game.add.tileSprite(0,0,w,h,"background"),Spaceshiplimit=levelConfig.waves[level].spaceships):1==partB&&(background=game.add.tileSprite(0,0,w,h,"background2"),Spaceshiplimit=levelConfigB.waves[level].spaceships),1==partC&&(background=game.add.tileSprite(0,0,w,h,"background2"),Spaceshiplimit=levelConfigC.waves[level].spaceships),SpaceshipLimit2=Spaceshiplimit}function createParallax(){w=game.world.width,h=game.world.height,mesh=game.add.tileSprite(0,0,w,h,"mesh")}function createSpaceCraft(){let x=game.width/2-25,y=game.height-75;spaceCraft=game.add.sprite(x,y,"ufo"),spaceCraft.alpha=1,tween=game.add.tween(spaceCraft).to({alpha:1},750,Phaser.Easing.Linear.None),tween.start(),backgroundblack=game.add.image(0,0,"black"),tween=game.add.tween(backgroundblack).to({alpha:0},650,Phaser.Easing.Linear.None),tween.start(),spaceCraft.anchor.setTo(.1,.1),spaceCraft.scale.setTo(.15,.15),game.physics.arcade.enable(spaceCraft),spaceCraft.body.collideWorldBounds=!0}function createSounds(){soundLaser=game.add.audio("laser"),soundBlast=game.add.audio("sndblast"),blip=game.add.audio("blip"),finalround=game.add.audio("finalround"),finalround2=game.add.audio("finalround2"),error=game.add.audio("error"),soundLaser.volume=music.volume,soundBlast.volume=music.volume,blip.volume=music.volume,finalround.volume=music.volume,finalround2.volume=music.volume,error.volume=music.volume,music.stop(),1==partA&&0==musicenabled?(musicInGame=game.add.audio("partAMusic"),musicInGame.play(),musicenabled=!0):1==partB&&0==musicenabled&&(musicInGame=game.add.audio("partBMusic"),musicInGame.play(),musicenabled=!0),1==partC&&0==musicenabled&&(musicInGame=game.add.audio("partCMusic"),musicInGame.play(),musicenabled=!0),musicInGame.volume=music.volume}function createSpaceships(){CounterSpaceships=0,Spaceships=game.add.group(),Spaceships.enableBody=!0,Spaceships.callAll("anchor.SetTo","anchor",.5,1),Spaceships.setAll("checkWorldBounds",!0),1==partA&&(SpaceshipsVelocity=levelConfig.waves[level].velocity),1==partB&&(SpaceshipsVelocity=levelConfigB.waves[level].velocity),1==partC&&(SpaceshipsVelocity=levelConfigC.waves[level].velocity),0==timer_activated&&game.time.events.loop(TIMER,timer,this),eventSpaceships=game.time.events.loop(TIMER,activateSpaceships,this)}function createBlasts(number){blasts=game.add.group(),blasts.createMultiple(number,"blast"),blasts.forEach(setupBlast,this)}function createKeyControls(){cursors=game.input.keyboard.createCursorKeys(),fireButton=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)}function createHUD(){let scoreX=5,levelX=game.world.width-45,allY=game.world.height-25;timeText=game.add.text(5,allY-20,"Time: "+time,DefaultFont),scoreText=game.add.text(5,allY,"Score: "+score,DefaultFont),levelText=game.add.text(levelX,allY,"Wave: "+(level+1),DefaultFont),levelText.anchor.setTo(.5,0)}function timer(){time++}function gradesToRadians(angle){return angle=angle*Math.PI/180}function activateSpaceships(){0==deadSpacecraft&&counterSpaceShipsWaves<SpaceshipLimit2&&(1==partA&&(SpaceshipWord=comproveLetter(1)),1!=partB&&1!=partC||(SpaceshipWord=comproveLetter(2)),x=Math.floor(450*Math.random()),1==medium_Enemy1?(nave=Spaceships.create(x,200,"alienmedium"),CounterMediumSpaceship=counterSpaceShipsWaves,eventSpaceshipsMediums=game.time.events.loop(4*TIMER,generateMediumSpaceships,this)):1==big_Enemy1?(nave=Spaceships.create(x,200,"alienbig"),CounterBigSpaceship=counterSpaceShipsWaves,eventSpaceshipsBigs=game.time.events.loop(6.5*TIMER,generateMiniSpaceships,this)):nave=Spaceships.create(x,200,"alienNormal"),nave.checkWorldBounds=!0,nave.events.onOutOfBounds.add(resetMember2,this),nave.scale.setTo(.1),d=Math.sqrt((x-spaceCraft.x)**2+(-spaceCraft.y)**2),angle=(x-spaceCraft.x)/d*-1/((-50-spaceCraft.y)/d*-1),angle=180*Math.atan(angle)/Math.PI,anglealeatorio=Math.floor(20*Math.random())-10,angle+=anglealeatorio,nave.angle-=angle,nave.reset(x,-25),vx=Math.cos(gradesToRadians(angle-90))*SpaceshipsVelocity,vy=Math.sin(gradesToRadians(angle-90))*SpaceshipsVelocity*-1,spaceShip_array.push(nave),1==medium_Enemy1?(vx/=2,vy/=2,medium_Enemy1=!1):1==big_Enemy1&&(vx/=3,vy/=3,big_Enemy1=!1),nave.body.velocity.x=vx,nave.body.velocity.y=vy,counterSpaceShipsWaves++,word=game.add.text(nave.x,nave.y,SpaceshipWord,DefaultFont),1==partC&&efectsPartC(),words_array.push(word),CounterSpaceships+=1,game.time.events.loop(1,moveText,this))}function efectsPartC(){whichone=Math.floor(Math.random()*levelConfigC.waves[level].probability+2),0!=whichone&&2!=whichone||(tween=game.add.tween(word).to({alpha:0},1500,Phaser.Easing.Linear.None).to({alpha:1},1500,Phaser.Easing.Linear.None),tween.loop(!0),tween.start()),1!=whichone&&2!=whichone||(tween=game.add.tween(word).to({angle:90},1500,Phaser.Easing.Linear.None).to({angle:0},1500,Phaser.Easing.Linear.None),tween.loop(!0),tween.start())}function generateMiniSpaceships(){if(0==bigSpaceShipDead&&0==deadSpacecraft){angle=-20;for(var c=0;c<5;c++)SpaceshipWord=levelConfig.elements[Math.floor(26*Math.random())].letter,x=spaceShip_array[CounterBigSpaceship].x,y=spaceShip_array[CounterBigSpaceship].y,nave=Spaceships.create(x,y,"alienmini"),nave.checkWorldBounds=!0,nave.events.onOutOfBounds.add(resetMember3,this),nave.scale.setTo(.1),nave.reset(x+30+sum,y+35),vx=Math.cos(gradesToRadians(angle-90))*SpaceshipsVelocity,vy=Math.sin(gradesToRadians(angle-90))*SpaceshipsVelocity*-1,spaceShip_array.push(nave),nave.body.velocity.x=vx/1.5,nave.body.velocity.y=vy/1.5,word=game.add.text(nave.x,nave.y-60,SpaceshipWord,DefaultFont),1==partC&&efectsPartC(),words_array.push(word),game.time.events.loop(1,moveText,this),angle+=10,CounterSpaceships+=1,Spaceshiplimit++}}function generateMediumSpaceships(){0==mediumSpaceshipdead&&0==deadSpacecraft&&(1==partA&&(SpaceshipWord=comproveLetter(1)),1!=partB&&1!=partC||(SpaceshipWord=comproveLetter(2)),x=spaceShip_array[CounterMediumSpaceship].x,y=spaceShip_array[CounterMediumSpaceship].y,nave=Spaceships.create(x,y,"alienNormal"),nave.checkWorldBounds=!0,nave.events.onOutOfBounds.add(resetMember2,this),nave.scale.setTo(.1),d=Math.sqrt((x-spaceCraft.x)**2+(y-spaceCraft.y)**2),angle=(x-spaceCraft.x)/d*-1/((y-spaceCraft.y)/d*-1),angle=180*Math.atan(angle)/Math.PI,angle=angle,nave.angle-=angle,nave.reset(x+28,y+35),vx=Math.cos(gradesToRadians(angle-90))*SpaceshipsVelocity,vy=Math.sin(gradesToRadians(angle-90))*SpaceshipsVelocity*-1,spaceShip_array.push(nave),nave.body.velocity.x=vx,nave.body.velocity.y=vy,word=game.add.text(nave.x,nave.y,SpaceshipWord,DefaultFont),1==partC&&efectsPartC(),words_array.push(word),CounterSpaceships+=1,Spaceshiplimit++,game.time.events.loop(1,moveText,this))}function newRound(){medium_Enemy=!1,big_Enemy=!1,medium_Enemy1=!1,big_Enemy1=!1,rightsLetterswaves=0,level++,timer_activated=!0,time-=3,counterSpaceShips=0,counterSpaceShipsWaves=0,spaceShip_array=[],words_array=[],uniqueletters=[],game.time.events.remove(eventSpaceships),game.time.events.remove(eventSpaceshipsMediums),game.time.events.remove(eventSpaceshipsBigs),endedRound=!1,bigSpaceShipDead=!1,mediumSpaceshipdead=!1,createPlay()}function createKeyWord(extrac){if(2==extrac){var tiponave=Math.floor(5*Math.random());return tiponave>=2&&0==medium_Enemy?(medium_Enemy=!0,medium_Enemy1=!0,levelConfigB.elements[Math.floor(26*Math.random())].measures[Math.floor(3*Math.random())].words[0]):tiponave>2&&0==big_Enemy?(big_Enemy=!0,big_Enemy1=!0,levelConfigB.elements[Math.floor(26*Math.random())].measures[Math.floor(2*Math.random())+3].words[0]):levelConfig.elements[Math.floor(26*Math.random())].measures[Math.floor(4*Math.random())].words[Math.floor(3*Math.random())]}return levelConfig.elements[Math.floor(26*Math.random())].measures[Math.floor(4*Math.random())].words[Math.floor(3*Math.random())]}function comproveLetter(extract){var p=createKeyWord(extract),again=0;for(let n=0;n<uniqueletters.length;n++)uniqueletters[n]==p.charAt(0)&&(again=1);1==again?(console.log("REPEATED WORD"),1==medium_Enemy1&&(medium_Enemy=!1),1==big_Enemy1&&(big_Enemy=!1),p=comproveLetter(extract)):uniqueletters.push(p.charAt(0));var randomNumber=Math.floor(Math.random()*levelConfigC.waves[level].probability);if(1==partC&&1==randomNumber){var p2="";for(let n=0;n<p.length;n++){var letter=p.charAt(n);Math.floor(3*Math.random())>1&&(letter=p.charAt(n).toUpperCase()),p2+=letter}p=p2}return p}function letterDown(e){e.keyCode>=Phaser.Keyboard.A&&e.keyCode<=Phaser.Keyboard.Z&&(0==fixed_Word&&0==deadSpacecraft&&(objetive=look_word(e.key),console.log("word selectionated: "+objetive)),""!=objetive&&(fixed_Word=!0,word=look_word2(objetive),e.key==objetive.charAt(0)?(0==counter&&(actual=game.add.sprite(spaceShip_array[word[1]].position.x-65,spaceShip_array[word[1]].position.y-50,"selectionated"),blip.play(),anim=actual.animations.add("selectionated"),anim.play(20,!1,!0)),word=look_word2(objetive),word[0].style.fill="#FF2D00",objetive=objetive.substring(1,objetive.length),words_array[word[1]].text=objetive,counter++,rightsLetterswaves++,rightsLetters++,writtenLetters++,score=100*rightsLetters/writtenLetters,laserimg=game.add.image(spaceCraft.x+20,spaceCraft.y-25,"laser"),tween=game.add.tween(laserimg).to({x:spaceShip_array[word[1]].position.x+20,y:spaceShip_array[word[1]].position.y+80,alpha:0},500,Phaser.Easing.Linear.None),tween.start(),soundLaser.play(),""==words_array[word[1]].text&&(spaceShip_array[word[1]].kill(),displayBlast(spaceShip_array[word[1]]),soundBlast.play(),uniqueletters.splice(word[1],word[1]+1),word[1]==CounterBigSpaceship&&(bigSpaceShipDead=!0),word[1]==CounterMediumSpaceship&&(mediumSpaceshipdead=!0))):(error.play(),writtenLetters++,score=100*rightsLetters/writtenLetters)),0==objetive.length&&0==endedRound&&0==deadSpacecraft&&(1==fixed_Word?counterSpaceShips++:(error.play(),writtenLetters++,score=100*rightsLetters/writtenLetters),fixed_Word=!1,counter=0))}function changeRound(){tween=game.add.tween(spaceCraft).to({alpha:0},500,Phaser.Easing.Linear.None),tween.start(),backgroundblack=game.add.image(0,0,"black"),backgroundblack.alpha=0,tween=game.add.tween(backgroundblack).to({alpha:1},750,Phaser.Easing.Linear.None),tween.start(),game.add.text(30,150,"   ROUND "+(level+1)+"\n COMPLETED!!!",DefaultFontEndRound),game.add.text(30,350,"letters typed right: "+rightsLetterswaves,DefaultFontEndRound2),game.add.text(30,400,"deactivated OWP: "+counterSpaceShips,DefaultFontEndRound2),1==partA&&game.add.text(30,500,"actual part: Part A ",DefaultFontEndRound2),1==partB&&game.add.text(30,500,"actual part: Part B ",DefaultFontEndRound2),1==partC&&game.add.text(30,500,"actual part: Part C ",DefaultFontEndRound2),game.add.text(30,450,"elapsed time: "+time,DefaultFontEndRound2),finalround.play(),finalround2.play(),endedRound=!0,levelConfig.waves[level].n<5?game.time.events.add(3e3,newRound,this):game.time.events.add(3e3,startWin,this)}function look_word(letter){var word="";for(let n=0;n<words_array.length;n++)if(letter==words_array[n].text.charAt(0))return word=words_array[n].text;if(""==word)return word}function look_word2(letter){let word="";for(let n=0;n<words_array.length;n++)if(letter==words_array[n].text){let lista;return word=words_array[n],[word,n]}if(""==word)return""}function moveText(){for(let n=0;n<words_array.length;n++)words_array[n].position.y=spaceShip_array[n].position.y+60,words_array[n].position.x=spaceShip_array[n].position.x}function quitwords(){for(let n=0;n<CounterSpaceships;n++)words_array[n].text=""}function setupBlast(blast){blast.anchor.x=.5,blast.anchor.y=.5,blast.animations.add("blast")}function displayBlast(ship){let blast=blasts.getFirstExists(!1),x=ship.body.center.x,y=ship.body.center.y;blast.reset(x,y),blast.play("blast",10,!1,!0)}function resetMember(item){item.kill()}function resetMember2(item2){var number;for(let i=0;i<words_array.length;i++)spaceShip_array[i].x==item2.x&&(number=i);words_array[number].text==objetive&&(fixed_Word=!1),uniqueletters.splice(number,number+1),counter=0,"alienNormal"==spaceShip_array[number].key?counterSpaceShipsWaves--:Spaceshiplimit--,item2.kill()}function resetMember3(item3){item3.kill(),Spaceshiplimit--}function startGameOver(){musicInGame.stop(),game.state.start("gameOver")}function startWin(){musicInGame.stop(),game.state.start("win")}function updatePlay(){game.physics.arcade.overlap(spaceCraft,Spaceships,ufoHitnave,null,this),updateBackground(),manageCraftMovements(),manageTexts(),counterSpaceShips==Spaceshiplimit&&0==endedRound&&0==deadSpacecraft&&changeRound(),game.input.keyboard.onDownCallback=letterDown}function ufoHitnave(nave,craft){nave.kill(),craft.kill(),displayBlast(nave),displayBlast(craft),soundBlast.play(),Spaceships.forEach(resetMember,this),quitwords(),game.input.enabled=!0,deadSpacecraft=!0,game.time.events.add(2e3,startGameOver,this)}function updateBackground(){background.tilePosition.y+=.5,mesh.tilePosition.y+=1,mesh.tilePosition.x+=.2}function manageCraftMovements(){spaceCraft.body.velocity.x=0,cursors.left.isDown||game.input.speed.x<0?spaceCraft.body.velocity.x=-150:(cursors.right.isDown||game.input.speed.x>0)&&(spaceCraft.body.velocity.x=150)}function manageTexts(){timeText.setText("Time: "+time,DefaultFont),scoreText.setText("Score: "+Math.floor(score)+" % ",DefaultFont)}